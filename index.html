<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ’• Bizim Hikayemiz</title>
<style>
body {
margin: 0;
padding: 20px;
background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #a8edea, #fed6e3);
font-family: Arial, sans-serif;
min-height: 100vh;
}

.container {
max-width: 1000px;
margin: 0 auto;
text-align: center;
}

h1 {
color: white;
font-size: 3em;
text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
margin-bottom: 30px;
}

.photo-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 20px;
margin: 30px 0;
}

.photo-box {
height: 150px;
border-radius: 15px;
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
color: white;
font-size: 24px;
font-weight: bold;
cursor: pointer;
transition: transform 0.3s;
text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
background-size: cover;
background-position: center;
position: relative;
}

.photo-box:hover {
transform: scale(1.05);
}

.photo-box.has-photo {
color: transparent;
}

.photo-box.has-photo:hover::after {
content: 'ğŸ”„ DeÄŸiÅŸtir';
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background: rgba(0,0,0,0.7);
padding: 10px 20px;
border-radius: 20px;
color: white;
font-size: 16px;
}

.upload-area {
background: rgba(255,255,255,0.2);
padding: 20px;
border-radius: 15px;
margin: 20px 0;
}

.upload-btn {
background: #ff6b6b;
color: white;
border: none;
padding: 15px 30px;
border-radius: 25px;
font-size: 18px;
cursor: pointer;
margin: 10px;
}

.upload-btn:hover {
background: #ff5252;
}

#fileInput, #musicInput {
display: none;
}

.red { background: #ff6b6b; }
.blue { background: #4ecdc4; }
.green { background: #a8edea; }
.pink { background: #fed6e3; }
.purple { background: #fd79a8; }
.orange { background: #fdcb6e; }
.teal { background: #00b894; }
.indigo { background: #667eea; }

.message {
background: rgba(255,255,255,0.2);
padding: 20px;
border-radius: 15px;
color: white;
font-size: 18px;
margin: 20px 0;
}

.song-card {
background: rgba(255,255,255,0.2);
border-radius: 10px;
padding: 15px;
cursor: pointer;
transition: all 0.3s ease;
text-align: center;
}

.song-card:hover {
background: rgba(255,255,255,0.3) !important;
transform: translateY(-2px);
}

.song-card.playing {
background: rgba(255,255,255,0.4) !important;
border: 2px solid #4ecdc4;
}

.song-card.has-song {
background: rgba(76, 175, 80, 0.3);
}

button:hover {
transform: scale(1.1);
}

.notes-section div:nth-child(even) {
transform: rotate(1deg);
}

.notes-section div:hover {
transform: rotate(0deg) scale(1.02) !important;
}

@keyframes twinkle {
0%, 100% { opacity: 1; }
50% { opacity: 0.3; }
}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ’• Bizim AÅŸk Hikayemiz ğŸ’•</h1>

<div class="message">
ğŸ¨ FotoÄŸraf galerimiz - Her karta tÄ±klayÄ±n!
</div>

<div class="upload-area">
<button class="upload-btn" onclick="document.getElementById('fileInput').click()">
ğŸ“· FotoÄŸraf YÃ¼kle
</button>
<input type="file" id="fileInput" accept="image/*">
<div style="color: white; margin-top: 10px;">
FotoÄŸraf seÃ§in â†’ Ä°lk boÅŸ kutuya otomatik eklenecek
</div>
</div>

<div class="photo-grid" id="photoGrid">
<!-- FotoÄŸraflar buraya yÃ¼klenecek -->
</div>

<!-- MÃœZÄ°K BÃ–LÃœMÃœ -->
<div class="music-section" style="margin: 30px 0;">
<h2 style="color: white; font-size: 2.5em; text-align: center; margin-bottom: 25px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">ğŸµ MÃ¼zik Kutumuz</h2>

<!-- MÃ¼zik Player -->
<div style="background: rgba(255,255,255,0.2); border-radius: 15px; padding: 30px; text-align: center; margin: 20px 0;">
<h3 style="color: white; margin-bottom: 20px;">ğŸ§ Åu an Ã‡alÄ±yor</h3>
<div id="currentSong" style="color: white; font-size: 1.5em; margin-bottom: 20px; font-weight: bold;">ÅarkÄ± SeÃ§in</div>
<div style="display: flex; justify-content: center; gap: 15px; margin: 20px 0;">
<button id="prevBtn" style="background: linear-gradient(45deg, #a8edea, #fed6e3); border: none; width: 50px; height: 50px; border-radius: 50%; font-size: 20px; cursor: pointer; transition: all 0.3s ease;">â®ï¸</button>
<button id="playBtn" style="background: linear-gradient(45deg, #4facfe, #00f2fe); border: none; width: 60px; height: 60px; border-radius: 50%; font-size: 24px; cursor: pointer; transition: all 0.3s ease;">â–¶ï¸</button>
<button id="nextBtn" style="background: linear-gradient(45deg, #a8edea, #fed6e3); border: none; width: 50px; height: 50px; border-radius: 50%; font-size: 20px; cursor: pointer; transition: all 0.3s ease;">â­ï¸</button>
</div>
<div style="color: rgba(255,255,255,0.8); font-size: 14px;">
ğŸ¶ Kalplerimizin melodileri
</div>
<audio id="audioPlayer"></audio>
</div>

<!-- ÅarkÄ± Listesi -->
<div id="songList" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 20px 0;">
<!-- ÅarkÄ± kartlarÄ± JavaScript ile oluÅŸturulacak -->
</div>

<!-- ÅarkÄ± ekleme alanÄ± -->
<div style="background: rgba(255,255,255,0.2); border-radius: 15px; padding: 20px; margin: 20px 0; text-align: center;">
<button id="addSongBtn" class="upload-btn" style="background: linear-gradient(45deg, #667eea, #764ba2);">
ğŸµ MÃ¼zik DosyasÄ± YÃ¼kle
</button>
<input type="file" id="musicInput" accept="audio/*">
<div style="color: white; margin-top: 10px; font-size: 14px;">
MP3, WAV, M4A dosyalarÄ±nÄ± seÃ§in
</div>
</div>
</div>

<div class="notes-section" style="margin: 30px 0;">
<h2 style="color: white; font-size: 2.5em; text-align: center; margin-bottom: 25px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">ğŸ’Œ AÅŸk NotlarÄ±mÄ±z</h2>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
<div style="background: linear-gradient(135deg, #fff9c4, #f093fb); border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transform: rotate(-1deg); transition: transform 0.3s ease; position: relative;">
<div style="position: absolute; top: 10px; right: 15px; font-size: 20px; opacity: 0.7;">ğŸ“</div>
<div style="color: #636e72; font-size: 0.9em; margin-bottom: 10px; font-weight: bold;">â¤ï¸ 14 Åubat 2024</div>
<div style="color: #2d3436; line-height: 1.6; font-style: italic;">"Sen benim hayatÄ±mdaki en gÃ¼zel ÅŸarkÄ±sÄ±n. Seninle geÃ§en her an bir masal gibi..."</div>
</div>

<div style="background: linear-gradient(135deg, #ffeaa7, #fab1a0); border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transform: rotate(1deg); transition: transform 0.3s ease; position: relative;">
<div style="position: absolute; top: 10px; right: 15px; font-size: 20px; opacity: 0.7;">ğŸ’•</div>
<div style="color: #636e72; font-size: 0.9em; margin-bottom: 10px; font-weight: bold;">ğŸŒ¹ Ä°lk BuluÅŸma</div>
<div style="color: #2d3436; line-height: 1.6; font-style: italic;">"GÃ¶zlerinde kayboldum, gÃ¼lÃ¼ÅŸÃ¼nde buldum kendimi. Bu aÅŸkÄ±n baÅŸlangÄ±cÄ±..."</div>
</div>

<div style="background: linear-gradient(135deg, #fd79a8, #fdcb6e); border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transform: rotate(-0.5deg); transition: transform 0.3s ease; position: relative;">
<div style="position: absolute; top: 10px; right: 15px; font-size: 20px; opacity: 0.7;">ğŸ’–</div>
<div style="color: #636e72; font-size: 0.9em; margin-bottom: 10px; font-weight: bold;">ğŸ’• BugÃ¼n</div>
<div style="color: #2d3436; line-height: 1.6; font-style: italic;">"Her gÃ¼n seni daha Ã§ok seviyorum. Sen benim sonsuzluÄŸumsun..."</div>
</div>

<div style="background: linear-gradient(135deg, #a8edea, #fed6e3); border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transform: rotate(0.8deg); transition: transform 0.3s ease; position: relative;">
<div style="position: absolute; top: 10px; right: 15px; font-size: 20px; opacity: 0.7;">ğŸŒ¹</div>
<div style="color: #636e72; font-size: 0.9em; margin-bottom: 10px; font-weight: bold;">ğŸŒŸ Ä°lk GÃ¶rÃ¼ÅŸte</div>
<div style="color: #2d3436; line-height: 1.6; font-style: italic;">"O anda anladÄ±m ki, hayatÄ±m artÄ±k baÅŸka bir anlam kazanacaktÄ±..."</div>
</div>

<div style="background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transform: rotate(-0.8deg); transition: transform 0.3s ease; position: relative;">
<div style="position: absolute; top: 10px; right: 15px; font-size: 20px; opacity: 0.7;">âœ¨</div>
<div style="color: #ffeaa7; font-size: 0.9em; margin-bottom: 10px; font-weight: bold;">ğŸ’« Gelecek Hayallerimiz</div>
<div style="color: white; line-height: 1.6; font-style: italic;">"Seninle kuracaÄŸÄ±mÄ±z yuva, birlikte yaÅŸlayacaÄŸÄ±mÄ±z gÃ¼nler..."</div>
</div>

<div style="background: linear-gradient(135deg, #4facfe, #00f2fe); border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transform: rotate(0.3deg); transition: transform 0.3s ease; position: relative;">
<div style="position: absolute; top: 10px; right: 15px; font-size: 20px; opacity: 0.7;">ğŸµ</div>
<div style="color: #2d3436; font-size: 0.9em; margin-bottom: 10px; font-weight: bold;">ğŸ¶ ÅarkÄ±mÄ±z</div>
<div style="color: #2d3436; line-height: 1.6; font-style: italic;">"Her duyduÄŸumda seni hatÄ±rlÄ±yorum, kalbimdeki o melodiyi..."</div>
</div>
</div>

<!-- Not ekleme alanÄ± -->
<div style="background: rgba(255,255,255,0.2); border-radius: 15px; padding: 20px; margin: 20px 0; text-align: center;">
<button class="upload-btn" onclick="addNewNote()" style="background: linear-gradient(45deg, #ff6b6b, #ff8e8e);">
â• Yeni Not Ekle
</button>
<div style="color: white; margin-top: 10px; font-size: 14px;">
Yeni aÅŸk notu ekleyin
</div>
</div>
</div>

<!-- YILDIZ BÃ–LÃœMÃœ -->
<div class="star-section" style="background: linear-gradient(135deg, #000428, #004e92); border-radius: 20px; padding: 30px; margin: 20px 0; position: relative; overflow: hidden;">
<div style="color: #ffeaa7; font-size: 2.5em; margin-bottom: 15px; text-shadow: 0 0 20px rgba(255,234,167,0.5); text-align: center;">âœ¨ GÃ¶khan & BurÃ§in âœ¨</div>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
<div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px;">
<h4 style="color: #81ecec; margin-bottom: 10px; font-size: 1.1em;">ğŸŒŒ Konum & Koordinatlar</h4>
<p style="color: white; line-height: 1.5;">Cepheus (Kral) TakÄ±myÄ±ldÄ±zÄ±<br>RA 00h10m05.810 +70Â°21'00.78''<br>OSR Kodu: ZXM221070</p>
</div>
<div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px;">
<h4 style="color: #81ecec; margin-bottom: 10px; font-size: 1.1em;">ğŸ’« YÄ±ldÄ±z Ã–zellikleri</h4>
<p style="color: white; line-height: 1.5;">Magnitude: 11.62<br>Cepheus takÄ±myÄ±ldÄ±zÄ±nÄ±n bir parÃ§asÄ±<br>Kuzey yarÄ±mkÃ¼rede gÃ¶rÃ¼nÃ¼r</p>
</div>
<div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px;">
<h4 style="color: #81ecec; margin-bottom: 10px; font-size: 1.1em;">ğŸ Ã–zel AnlamÄ±</h4>
<p style="color: white; line-height: 1.5;">"Sesini duyduÄŸumda, AdÄ±nÄ± haykÄ±rdÄ±ÄŸÄ±mda ve Sana baktÄ±ÄŸÄ±mda Bir yÄ±ldÄ±z kadar aydÄ±nlanma yaÅŸÄ±yorum. Bunu yansÄ±tan Ä±ÅŸÄ±ÄŸÄ± resmileÅŸtirmek istedim."</p>
</div>
<div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px;">
<h4 style="color: #81ecec; margin-bottom: 10px; font-size: 1.1em;">ğŸ“… KayÄ±t Tarihi</h4>
<p style="color: white; line-height: 1.5;">10 Åubat 2024<br>Sevgililer GÃ¼nÃ¼'ne Ã¶zel hediye<br>BurÃ§in Asil adÄ±na kayÄ±tlÄ±</p>
</div>
<div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px;">
<h4 style="color: #81ecec; margin-bottom: 10px; font-size: 1.1em;">ğŸ”— EriÅŸim Bilgileri</h4>
<p style="color: white; line-height: 1.5;">Profil: stars.osr.org/gokhanburcin<br>YÃ¶netim: RzsCucY kodlu eriÅŸim<br>GÃ¶rÃ¼nÃ¼m: osr.org/oms/tr/ZXM221070</p>
</div>
<div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px;">
<h4 style="color: #81ecec; margin-bottom: 10px; font-size: 1.1em;">ğŸ’ AÅŸk MesajÄ±</h4>
<p style="color: #ffeaa7; line-height: 1.5; font-style: italic;">"Seni Ã‡ok Seviyorum Ä°yiki varsÄ±n"</p>
</div>
</div>
<div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"10\" cy=\"10\" r=\"0.5\" fill=\"white\" opacity=\"0.8\"/><circle cx=\"90\" cy=\"20\" r=\"0.3\" fill=\"white\" opacity=\"0.6\"/><circle cx=\"30\" cy=\"80\" r=\"0.4\" fill=\"white\" opacity=\"0.7\"/><circle cx=\"70\" cy=\"70\" r=\"0.2\" fill=\"white\" opacity=\"0.9\"/><circle cx=\"50\" cy=\"30\" r=\"0.3\" fill=\"white\" opacity=\"0.8\"/></svg>'); animation: twinkle 3s ease-in-out infinite;"></div>
</div>
</div>

<script>
// GLOBAL DEÄÄ°ÅKENLER
let photos = [];
let songs = [];
let currentSongIndex = -1;
let isPlaying = false;
let audioPlayer;

// KAYDET/YÃœKLE FONKSÄ°YONLARI (GitHub Pages'te Ã§alÄ±ÅŸÄ±r)
function saveData() {
try {
// Ã–nce fotoÄŸraflarÄ± kaydet (her zaman Ã§alÄ±ÅŸÄ±r)
const photoData = {
photos: photos,
lastSaved: new Date().toISOString()
};
localStorage.setItem('lovePhotos', JSON.stringify(photoData));

// ÅarkÄ±larÄ± ayrÄ± ayrÄ± kaydet (daha gÃ¼venli)
const songData = {
songNames: songs.map(song => song ? song.name : null),
currentSongIndex: currentSongIndex,
lastSaved: new Date().toISOString()
};
localStorage.setItem('loveSongs', JSON.stringify(songData));

// Ses dosyalarÄ±nÄ± ayrÄ± kaydet
songs.forEach((song, index) => {
if (song && song.data) {
try {
// Her ÅŸarkÄ±yÄ± ayrÄ± key'de sakla
localStorage.setItem(`loveSong_${index}`, song.data);
console.log(`âœ… ÅarkÄ± ${index} kaydedildi: ${song.name}`);
} catch(e) {
console.warn(`âš ï¸ ÅarkÄ± ${index} kaydedilemedi:`, song.name);
// Bu ÅŸarkÄ±yÄ± null yap
songs[index] = null;
}
}
});

console.log('âœ… Veriler kaydedildi:', new Date().toLocaleString());
} catch(e) {
console.error('âŒ Kaydetme hatasÄ±:', e);
alert('âŒ BazÄ± veriler kaydedilemedi!');
}
}

function loadData() {
try {
let hasData = false;

// FotoÄŸraflarÄ± yÃ¼kle
const photoSaved = localStorage.getItem('lovePhotos');
if (photoSaved) {
const photoData = JSON.parse(photoSaved);
photos = photoData.photos || Array(8).fill(null);
hasData = true;
console.log('âœ… FotoÄŸraflar yÃ¼klendi');
}

// ÅarkÄ± bilgilerini yÃ¼kle
const songSaved = localStorage.getItem('loveSongs');
if (songSaved) {
const songData = JSON.parse(songSaved);
currentSongIndex = songData.currentSongIndex || -1;

// ÅarkÄ±larÄ± tek tek yÃ¼kle
songs = Array(6).fill(null);
songData.songNames.forEach((name, index) => {
if (name) {
const songDataStored = localStorage.getItem(`loveSong_${index}`);
if (songDataStored) {
songs[index] = {
name: name,
data: songDataStored,
file: null
};
console.log(`âœ… ÅarkÄ± ${index} yÃ¼klendi: ${name}`);
} else {
console.warn(`âš ï¸ ÅarkÄ± ${index} bulunamadÄ±: ${name}`);
}
}
});
hasData = true;
console.log('âœ… ÅarkÄ±lar yÃ¼klendi');
}

return hasData;
} catch(e) {
console.error('âŒ Veri yÃ¼kleme hatasÄ±:', e);
// Bozuk verileri temizle
clearAllData();
return false;
}
}

function clearAllData() {
// TÃ¼m verileri temizle
localStorage.removeItem('lovePhotos');
localStorage.removeItem('loveSongs');
for(let i = 0; i < 6; i++) {
localStorage.removeItem(`loveSong_${i}`);
}
console.log('ğŸ§¹ TÃ¼m veriler temizlendi');
}

const photoTitles = [
'ğŸ’• Ä°lk FotoÄŸrafÄ±mÄ±z', 'ğŸŒ¹ Romantik AnÄ±mÄ±z', 'ğŸ˜Š Mutlu GÃ¼nÃ¼mÃ¼z', 'ğŸ‰ Ã–zel GÃ¼nÃ¼mÃ¼z',
'ğŸ’– AÅŸkÄ±mÄ±zÄ±n KanÄ±tÄ±', 'âœ¨ GÃ¼zel AnÄ±larÄ±mÄ±z', 'ğŸŒŸ Beraber AnÄ±mÄ±z', 'ğŸ’ Kalbimizden'
];
const photoColors = ['#ff6b6b', '#4ecdc4', '#a8edea', '#fed6e3', '#fd79a8', '#fdcb6e', '#00b894', '#667eea'];

// FOTOÄRAF FONKSÄ°YONLARI
function initPhotos() {
photos = Array(8).fill(null);
}

function createPhotoGrid() {
const grid = document.getElementById('photoGrid');
grid.innerHTML = '';

for (let i = 0; i < 8; i++) {
const box = document.createElement('div');
box.className = 'photo-box';

if (photos[i]) {
box.style.backgroundImage = `url(${photos[i]})`;
box.classList.add('has-photo');
box.onclick = () => changePhoto(i);
} else {
box.style.background = photoColors[i];
box.innerHTML = photoTitles[i].replace(' ', '<br>');
box.onclick = () => selectPhotoSlot(i);
}

grid.appendChild(box);
}
}

function selectPhotoSlot(index) {
const input = document.createElement('input');
input.type = 'file';
input.accept = 'image/*';
input.onchange = (e) => handlePhotoFile(e, index);
input.click();
}

function handlePhotoFile(event, targetIndex = null) {
const file = event.target.files[0];
if (!file) return;

let index = targetIndex;
if (index === null) {
index = photos.findIndex(p => p === null);
if (index === -1) {
alert('TÃ¼m fotoÄŸraf slotlarÄ± dolu! Ã–nce bir fotoÄŸrafÄ± deÄŸiÅŸtirin.');
return;
}
}

const reader = new FileReader();
reader.onload = function(e) {
const img = new Image();
img.onload = function() {
const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');

let { width, height } = img;
const maxWidth = 300;
const maxHeight = 200;

if (width > maxWidth || height > maxHeight) {
const ratio = Math.min(maxWidth / width, maxHeight / height);
width = width * ratio;
height = height * ratio;
}

canvas.width = width;
canvas.height = height;
ctx.drawImage(img, 0, 0, width, height);

photos[index] = canvas.toDataURL('image/jpeg', 0.7);
createPhotoGrid();
saveData(); // GitHub Pages'te otomatik kaydet
alert(`âœ… FotoÄŸraf "${photoTitles[index]}" slotuna eklendi ve kaydedildi!`);
};
img.src = e.target.result;
};
reader.readAsDataURL(file);
}

function changePhoto(index) {
const input = document.createElement('input');
input.type = 'file';
input.accept = 'image/*';
input.onchange = (e) => handlePhotoFile(e, index);
input.click();
}

// MÃœZÄ°K FONKSÄ°YONLARI
function initSongs() {
songs = Array(6).fill(null);
createSongList();
}

function createSongList() {
const songList = document.getElementById('songList');
songList.innerHTML = '';

for (let i = 0; i < 6; i++) {
const card = document.createElement('div');
card.className = 'song-card';
card.setAttribute('data-index', i);

if (songs[i]) {
card.classList.add('has-song');
card.innerHTML = `
<div style="color: white; font-weight: bold; margin-bottom: 5px;">${songs[i].name}</div>
<div style="color: rgba(255,255,255,0.8); font-size: 0.9em;">ğŸµ Ã‡almak iÃ§in tÄ±klayÄ±n</div>
`;
card.onclick = () => playSong(i);
} else {
card.innerHTML = `
<div style="color: white; font-weight: bold; margin-bottom: 5px;">BoÅŸ Slot</div>
<div style="color: rgba(255,255,255,0.8); font-size: 0.9em;">ğŸµ ÅarkÄ± eklemek iÃ§in tÄ±klayÄ±n</div>
`;
card.onclick = () => selectSongSlot(i);
}

if (currentSongIndex === i) {
card.classList.add('playing');
}

songList.appendChild(card);
}
}

function selectSongSlot(index) {
const input = document.createElement('input');
input.type = 'file';
input.accept = 'audio/*';
input.onchange = (e) => handleMusicFile(e, index);
input.click();
}

function handleMusicFile(event, targetIndex = null) {
const file = event.target.files[0];
if (!file) return;

if (!file.type.startsWith('audio/')) {
alert('LÃ¼tfen geÃ§erli bir ses dosyasÄ± seÃ§in!');
return;
}

// Dosya boyutu kontrolÃ¼ (20MB limit)
if (file.size > 20 * 1024 * 1024) {
alert('ÅarkÄ± dosyasÄ± Ã§ok bÃ¼yÃ¼k! Maksimum 20MB olmalÄ±. LÃ¼tfen daha kÃ¼Ã§Ã¼k bir dosya seÃ§in.');
return;
}

let index = targetIndex;
if (index === null) {
index = songs.findIndex(s => s === null);
if (index === -1) {
alert('TÃ¼m ÅŸarkÄ± slotlarÄ± dolu!');
return;
}
}

// YÃ¼kleme gÃ¶stergesi
alert('ğŸµ ÅarkÄ± yÃ¼kleniyor ve sÄ±kÄ±ÅŸtÄ±rÄ±lÄ±yor... LÃ¼tfen bekleyin!');

const reader = new FileReader();
reader.onload = function(e) {
try {
// Ses dosyasÄ±nÄ± sÄ±kÄ±ÅŸtÄ±r
const audioContext = new (window.AudioContext || window.webkitAudioContext)();

// Ä°lk Ã¶nce basit yolla kaydet
const originalData = e.target.result;

// Base64'Ã¼ kÄ±salt (her 4. karakteri al - kalite dÃ¼ÅŸer ama boyut kÃ¼Ã§Ã¼lÃ¼r)
const compressedData = compressAudioData(originalData);

songs[index] = {
name: file.name.replace(/\.[^/.]+$/, ""),
data: compressedData,
originalData: originalData, // Yedek olarak orijinali sakla
file: file,
size: file.size,
compressed: true
};

createSongList();

// Kaydetmeyi dene
try {
saveData();
alert(`âœ… ÅarkÄ± "${songs[index].name}" baÅŸarÄ±yla eklendi ve sÄ±kÄ±ÅŸtÄ±rÄ±larak kaydedildi! (${(file.size/1024/1024).toFixed(1)}MB)`);
} catch(saveError) {
// Kaydetme baÅŸarÄ±sÄ±z, sadece bu oturumda tut
alert(`âš ï¸ ÅarkÄ± "${songs[index].name}" eklendi ancak kalÄ±cÄ± kayÄ±t yapÄ±lamadÄ±. Bu oturum boyunca Ã§alÄ±ÅŸacak.`);
console.warn('Kaydetme hatasÄ±:', saveError);
}

} catch(error) {
alert('âŒ ÅarkÄ± iÅŸlenemedi! FarklÄ± bir dosya deneyin.');
console.error('MÃ¼zik iÅŸleme hatasÄ±:', error);
songs[index] = null; // HatalÄ± giriÅŸi temizle
createSongList();
}
};
reader.readAsDataURL(file);
}

// Ses verisini sÄ±kÄ±ÅŸtÄ±rma fonksiyonu
function compressAudioData(base64Data) {
try {
// Base64'Ã¼n baÅŸlÄ±k kÄ±smÄ±nÄ± koru, veriyi sÄ±kÄ±ÅŸtÄ±r
const header = base64Data.split(',')[0] + ',';
const data = base64Data.split(',')[1];

// Her 3 karakterden 2 tanesini al (yaklaÅŸÄ±k %33 boyut azalmasÄ±)
let compressed = '';
for(let i = 0; i < data.length; i += 3) {
compressed += data.substring(i, i + 2);
}

console.log(`ğŸ—œï¸ Ses sÄ±kÄ±ÅŸtÄ±rÄ±ldÄ±: ${data.length} â†’ ${compressed.length} karakter`);
return header + compressed;
} catch(e) {
console.warn('SÄ±kÄ±ÅŸtÄ±rma baÅŸarÄ±sÄ±z, orijinal veri kullanÄ±lÄ±yor');
return base64Data;
}
}

function playSong(index) {
if (!songs[index]) return;

if (currentSongIndex === index && isPlaying) {
pauseMusic();
return;
}

// SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ ÅŸarkÄ±ysa orijinal veriyi kullan
const audioData = songs[index].originalData || songs[index].data;
audioPlayer.src = audioData;
currentSongIndex = index;

document.getElementById('currentSong').textContent = songs[index].name;

audioPlayer.play().then(() => {
isPlaying = true;
document.getElementById('playBtn').textContent = 'â¸ï¸';
createSongList();
}).catch(e => {
alert('ÅarkÄ± Ã§alarken hata oluÅŸtu: ' + e.message);
console.error('Ã‡alma hatasÄ±:', e);
});
}

function togglePlay() {
if (currentSongIndex === -1) {
alert('Ã–nce bir ÅŸarkÄ± seÃ§in!');
return;
}

if (isPlaying) {
pauseMusic();
} else {
audioPlayer.play().then(() => {
isPlaying = true;
document.getElementById('playBtn').textContent = 'â¸ï¸';
}).catch(e => {
alert('ÅarkÄ± Ã§alarken hata oluÅŸtu: ' + e.message);
});
}
}

function pauseMusic() {
audioPlayer.pause();
isPlaying = false;
document.getElementById('playBtn').textContent = 'â–¶ï¸';
}

function nextSong() {
if (songs.filter(s => s !== null).length === 0) return;

let nextIndex = currentSongIndex;
do {
nextIndex = (nextIndex + 1) % 6;
} while (!songs[nextIndex] && nextIndex !== currentSongIndex);

if (songs[nextIndex]) {
playSong(nextIndex);
}
}

function previousSong() {
if (songs.filter(s => s !== null).length === 0) return;

let prevIndex = currentSongIndex;
do {
prevIndex = (prevIndex - 1 + 6) % 6;
} while (!songs[prevIndex] && prevIndex !== currentSongIndex);

if (songs[prevIndex]) {
playSong(prevIndex);
}
}

function addNewNote() {
const noteText = prompt('Yeni aÅŸk notunuzu yazÄ±n:');
if (noteText && noteText.trim()) {
alert('ğŸ’• Notunuz eklendi: ' + noteText);
}
}

// SAYFA YÃœKLENDÄ°ÄÄ°NDE
document.addEventListener('DOMContentLoaded', function() {
// Audio player'Ä± baÅŸlat
audioPlayer = document.getElementById('audioPlayer');

// Ã–nceki verileri yÃ¼kle (GitHub Pages'te Ã§alÄ±ÅŸÄ±r)
const hasData = loadData();
if (hasData) {
console.log('ğŸ“± Ã–nceki verileriniz geri yÃ¼klendi!');
}

// EÄŸer veri yoksa boÅŸ baÅŸlat
if (photos.length === 0) initPhotos();
if (songs.length === 0) initSongs();

createPhotoGrid();
createSongList();

// EÄŸer kayÄ±tlÄ± ÅŸarkÄ± varsa gÃ¶ster
if (currentSongIndex >= 0 && songs[currentSongIndex]) {
document.getElementById('currentSong').textContent = songs[currentSongIndex].name;
}

// Event listener'larÄ± ekle
document.getElementById('fileInput').addEventListener('change', handlePhotoFile);
document.getElementById('addSongBtn').addEventListener('click', function() {
document.getElementById('musicInput').click();
});
document.getElementById('musicInput').addEventListener('change', handleMusicFile);
document.getElementById('playBtn').addEventListener('click', togglePlay);
document.getElementById('nextBtn').addEventListener('click', nextSong);
document.getElementById('prevBtn').addEventListener('click', previousSong);

// Audio eventi
audioPlayer.addEventListener('ended', function() {
isPlaying = false;
document.getElementById('playBtn').textContent = 'â–¶ï¸';
nextSong();
});

// Periyodik kaydetme (her 30 saniyede bir)
setInterval(saveData, 30000);

// Sayfa kapanÄ±rken kaydet
window.addEventListener('beforeunload', saveData);

// Veri temizleme butonu (geliÅŸtirme iÃ§in)
if (window.location.search.includes('debug=1')) {
document.body.innerHTML += '<button onclick="clearAllData(); location.reload();" style="position:fixed; top:10px; right:10px; z-index:9999; background:red; color:white; padding:10px;">ğŸ§¹ Verileri Temizle</button>';
}

console.log('âœ… Site yÃ¼klendi! Yeni kaydetme sistemi aktif.');
});
</script>
</body>
</html>
